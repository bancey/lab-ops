parameters:
  - name: addresses
    type: string

steps:
  - script: |
      if [[ "${{ parameters.addresses }}" == *","* ]]; then
        OUTPUT=true
        for address in ${${{ parameters.addresses }}//,/ }
        do
          if nc -z $address 22 2>/dev/null; then
            echo "$address ✓"
          else
            echo "$address ✗"
            OUTPUT=false
          fi
        done
        if [[ "$OUTPUT" == "true" ]]; then
          echo "##vso[task.setvariable variable=online;isOutput=true]true"
        else
          echo "##vso[task.setvariable variable=online;isOutput=true]false"
        fi
      else
        if nc -z ${{ parameters.address }} 22 2>/dev/null; then
          echo "${{ parameters.address }} ✓"
          echo "##vso[task.setvariable variable=online;isOutput=true]true"
        else
          echo "${{ parameters.address }} ✗"
          echo "##vso[task.setvariable variable=online;isOutput=true]false"
        fi
      fi
    name: checkOnline
